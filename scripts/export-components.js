const fs = require('fs')
const glob = require('glob')

glob(__dirname + '/../src/components/**/*.vue', {}, (err, files) => {
  const plugin = [`export { default, modalPlugin } from './plugins'`]
  const components = files.map(file => {
    const start = file.indexOf('src/components/') + 4
    const path = file.slice(start)
    const name = path
      .split('\\')
      .pop()
      .split('/')
      .pop()
      .replace('.vue', '')

    return `export { default as ${name} } from './${path}'`
  })

  fs.writeFileSync(
    'src/main.js',
    [
      `// DO NOT EDIT - Autogenerated by /scripts/export-components.js`,
      ...plugin,
      ...components,
    ].join('\r\n') + '\r\n'
  )
})
